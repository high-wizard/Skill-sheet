<html lang="ja"><head>
<meta charset="UTF-8">

<p style="padding-top: 20px; padding-left: 20px; font-size: large;">
※こちらは見本です<br>
※経歴追加ボタンを押すことで経歴の入力欄が追加されます<br>
※経歴削除ボタンを押すことで最下部の経歴の入力欄が削除されます<br>
※記入し終えたら保存ボタンを押し、保存されたファイルを送付してください<br>
※保存したファイルは経歴書更新時にも使えるので保管してください<br>
<button onclick="window.close();">戻る</button>
</p>

<hr>

<title>業務経歴書</title>
<meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1">
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<style>
    td {
        width: 90px;
        height: 30px;
    }

    a {
        padding: 20px;
    }
    textarea {
        resize: none;
    }
    table {
        table-layout:fixed;
        width:100%;
        margin: auto;
    }
    td {
        word-break:break-all;
    }
    input,textarea,select {
        width:100%;
    }
    select {
        height:30px;
    }
    input {
        height:90%
    }
</style>
</head>
<body>
<div id="commonHead">
<h2 style="text-align: center; padding-top: 20px;">業務経歴</h2>
<h4 style="text-align: right; padding-right: 90px;" id="today">作成日：2020/4/9</h4>

<div class="container-fluid">
    <div class="row">
        <div class="col-auto flex-md-fill" id="input">
<br><table border="1" style="border-collapse: collapse;margin-bottom: 20px;" width="95%">
<tbody><tr>
<td rowspan="2">氏名</td>
<td>サンプル タロウ</td>
<td rowspan="2">性別</td>
<td rowspan="2">男</td>
<td rowspan="2">生年月日</td>
<td rowspan="2" name="ymd">1995/10/01</td>
<td rowspan="2">年齢</td>
<td rowspan="2" id="age">24</td>
</tr>

<tr>
<td>サンプル 太郎</td>
</tr>

<tr>
    <td colspan="1">現住所</td>
    <td colspan="7">北海道札幌市XXX</td>
</tr>

<tr>
    <td>交通機関</td>
    <td colspan="3">南北線</td>
    <td>最寄駅</td>
    <td colspan="3">麻生駅</td>
</tr>

<tr>
    <td>学歴</td>
    <td colspan="7">北海道大学経済学部 卒業</td>
</tr>

<tr>
    <td>免許/資格</td>
    <td colspan="7">普通自動車免許</td>
</tr>



<tr>
    <td>PCスキル</td>
    <td colspan="7">Windows</td>
</tr>
<tr>
    <td>使用可能言語、ツール</td>
    <td colspan="7">Java, C#, JavaScript, PostgreSQL, OracleDB, TortoiseSVN, TortoiseGit</td>
</tr>
<tr>
    <td>対応可能な作業、職域</td>
    <td colspan="7">外部設計、詳細設計、プログラム製造 メンバ</td>
</tr>
<tr>
    <td>特記事項</td>
    <td colspan="7"></td>
</tr>
</tbody></table>


    <div id="career1" style="page-break-inside:avoid;">
    <table name="careerTable" id="careerTable1" border="1" style="border-collapse: collapse; margin-bottom: 20px;">
    <tbody><tr>
    <td colspan="7">No.1</td>
    </tr>
    <tr>

    <td rowspan="2">年月</td>
    <td rowspan="2">システム名/事業内容</td>
    <td rowspan="2">開発チーム/人数</td>
    <td rowspan="2">作業内容</td>
    <td rowspan="2">職域</td>
    <td rowspan="2">システム環境</td>
    <td rowspan="2">月数</td>
    </tr>
    
    <tr>
    </tr>
    
    <tr>
        <td name="ym">2018/04</td>
        <td rowspan="2">電力事業者向け基幹システム</td>
        <td rowspan="2">20</td>


        <td rowspan="2">プログラム製造・単体テスト<br>総合テスト</td>


        <td rowspan="2">メンバー</td>

        <td rowspan="2">Oracle,Java</td>
        <td rowspan="2">12</td>
    </tr>

    <tr>
        <td name="ym">2019/03</td>
    </tr>

    <tr>
        <td>補足事項</td>
        <td colspan="6">【システム概要】<br>　顧客、契約等の情報を管理するシステム<br>【業務内容】<br>　コーディング、単体テスト、結合テスト、データ移行、総合テストを実施</td>
    </tr>
    </tbody></table>
    </div>
    </div>
</div>
</div>
</div>

<div style="padding-top: 20px; padding-bottom: 45px; text-align: center;" id="down">
    <a class="btn-info" id="addCareer" href="#down" style="display: none;">経歴追加</a>
    <a class="btn-info" id="deleteButton" href="#down" style="display: none;">経歴削除</a>
    <a class="btn-info" id="download" href="blob:null/fd2b7532-b629-4990-9c1f-2871c4462a2a" download="経歴書.html" style="display: none;">保存する</a>
    <a class="btn-info" id="print" href="#" style="display: none;">印刷表示</a>
</div>
<script>

let index = document.getElementsByName("careerTable").length;

const getAge = () =>
{
    const text = document.getElementById("birthDay").value;
    if(text && text.length == 8)
    {
        const year = text.substr(0,4);
        const month = text.substr(4,2);
        const day = text.substr(6,2);

        const birthDate = new Date(year, month - 1, day);
        const y2 = birthDate.getFullYear().toString().padStart(4, '0');
        const m2 = (birthDate.getMonth() + 1).toString().padStart(2, '0');
        const d2 = birthDate.getDate().toString().padStart(2, '0');

        const today = new Date();
        const y1 = today.getFullYear().toString().padStart(4, '0');
        const m1 = (today.getMonth() + 1).toString().padStart(2, '0');
        const d1 = today.getDate().toString().padStart(2, '0');

        const age = Math.floor((Number(y1 + m1 + d1) - Number(y2 + m2 + d2)) / 10000);

        document.getElementById("age").innerText = age;
    }
}

const getMonths = () =>
{
    for(var i=1; i<index+1; i++)
    {
        if(document.getElementById(`months${i}`).value) continue;

        const startDate = document.getElementById(`start${i}`).value;
        const y1 = startDate.substr(0,4);
        const m1 = startDate.substr(4,2);

        const endDate = document.getElementById(`end${i}`).value;
        const y2 = endDate.substr(0,4);
        const m2 = endDate.substr(4,2);

        if(startDate.length==6 && endDate.length==6){
            const startMonths = Number(y1)*12 + Number(m1);
            const endMonths = Number(y2)*12 + Number(m2);
            document.getElementById(`months${i}`).value = endMonths - startMonths + 1;
        }
    }
}

const addCareer = () =>
{
    index++;
    const HTML_TEMPLATE = `
    <div id="career${index}" style="page-break-inside:avoid;">
    <table name="careerTable" id="careerTable${index}" border="1" style="border-collapse: collapse; margin-bottom: 20px;">
    <tr>
    <td colspan="7">No.${index}</td>
    </tr>
    <tr>

    <td rowspan="2">年月</td>
    <td rowspan="2">システム名/事業内容</td>
    <td rowspan="2">開発チーム/人数</td>
    <td rowspan="2">作業内容</td>
    <td rowspan="2">職域</td>
    <td rowspan="2">システム環境</td>
    <td rowspan="2">月数</td>
    </tr>
    
    <tr>
    </tr>
    
    <tr>
        <td name="ym"><input type="number" placeholder="自 年月(yyyymm)" oninput="sliceMaxLength(this, 6)" id="start${index}"></td>
        <td rowspan="2"><input type="text" placeholder="●●システム"></td>
        <td rowspan="2"><input type="text" placeholder="人数"></td>


        <td rowspan="2">
        <select id="WorkContentSelector${index}">
        <option hidden>選択してください</option>
        <option value="要件定義">要件定義</option>
        <option value="外部設計・基本設計">外部設計・基本設計</option>
        <option value="内部設計・詳細設計">内部設計・詳細設計</option>
        <option value="プログラム製造・単体テスト">プログラム製造・単体テスト</option>
        <option value="総合テスト">総合テスト</option>
        <option value="サポート">サポート</option>
        <option value="オペレーション">オペレーション</option>
        </select>
        <button onClick="addWorkContent(${index})">作業内容追加</button>
        <textarea id="WorkContent${index}" placeholder="作業内容\r\n(コンボボックスから追加してください)" cols="50" rows="4"></textarea>
        </td>


        <td rowspan="2">
        <select id="OccupationSelector${index}">
        <option hidden>選択してください</option>
        <option value="プロジェクトマネージャー">プロジェクトマネージャー</option>
        <option value="プロジェクトリーダー">プロジェクトリーダー</option>
        <option value="サブリーダー">サブリーダー</option>
        <option value="メンバー">メンバー</option>
        <option value="その他">その他</option>
        </select>
        <button onClick="addOccupation(${index})">職域追加</button>
        <textarea id="Occupation${index}" placeholder="職域\r\n(コンボボックスから追加してください)" cols="50" rows="4"></textarea>
        </td>

        <td rowspan="2"><input type="text" placeholder="OS DB 言語"></td>
        <td rowspan="2"><input type="text" placeholder="※印刷時自動入力" id="months${index}"></td>
    </tr>

    <tr>
        <td name="ym"><input type="number" placeholder="至 年月(yyyymm)" oninput="sliceMaxLength(this, 6)" id="end${index}"></td>
    </tr>

    <tr>
        <td>補足事項</td>
        <td colspan="6"><textarea placeholder="補足事項" rows="6"></textarea></td>
    </tr>
    </table>
    </div>
    `;
    document.getElementById("input").insertAdjacentHTML('beforeend',HTML_TEMPLATE);
}

const addWorkContent = (index) =>
{
    if(document.getElementById(`WorkContentSelector${index}`).value=="選択してください")
    {
        return;
    }
    let addText = "";
    if(document.getElementById(`WorkContent${index}`).value.length!=0)
    {
        addText += "\r\n";
    }
    addText += document.getElementById(`WorkContentSelector${index}`).value;

    document.getElementById(`WorkContent${index}`).value += addText;
}


const addOccupation = (index) =>
{
    if(document.getElementById(`OccupationSelector${index}`).value=="選択してください")
    {
        return;
    }
    let addText = "";
    if(document.getElementById(`Occupation${index}`).value.length!=0)
    {
        addText += "\r\n";
    }
    addText += document.getElementById(`OccupationSelector${index}`).value;

    document.getElementById(`Occupation${index}`).value += addText;
}

const deleteButton = () =>
{
    if(index==0) return;
    document.getElementById(`careerTable${index}`).remove();
    index--;
}

const download = () => 
{
    valueSaver();
    const title = 'test.html';
    const data = document.getElementsByTagName("html")[0].innerHTML;
    const blob = new Blob([`<html>${data}</html>`], { type: "text/plain;charset=UTF-8" });
    if (window.navigator.msSaveBlob) { 
        window.navigator.msSaveBlob(blob, "経歴書.html"); 
        window.navigator.msSaveOrOpenBlob(blob, "経歴書.html"); 
    } else {
        document.getElementById("download").href = window.URL.createObjectURL(blob);
    }
}

const valueSaver = () =>
{
    document.querySelectorAll("input,textarea").forEach((el) => {
        el.defaultValue = el.value;
    });
}

const print = () =>
{
    getMonths();
    const result = window.confirm('【注意】\r\n印刷表示すると編集画面には戻れません。\r\n保存していない場合はキャンセルを押して保存してください。\r\n既に保存している場合はOKボタンを押してください。\r\n印刷時にはヘッダーとフッターは非表示にしてください');
    if(!result) return;
    document.querySelectorAll("input,textarea").forEach((el) => {
        el.parentNode.innerText = el.value;
        el.style.display = "none";
    });





document.querySelectorAll("a").forEach((el) => el.style.display = "none");
    document.querySelectorAll("td[name='ymd'],td[name='ym']").forEach((el) =>
    {
        const date = el.innerText;
        const y = date.substr(0,4);
        const m = date.substr(4,2);
        if(el.innerText.length == 8) {
            const d = date.substr(6,2);
            el.innerText = `${y}/${m}/${d}`;
            return;
        }
        if(el.innerText.length == 6)
        {
            el.innerText = `${y}/${m}`;
        }
    });

    window.print();
}


const sliceMaxLength = (elem, maxLength) => {  
    elem.value = elem.value.slice(0, maxLength);  
}  

document.getElementById("birthDay").addEventListener('change', getAge, false);
document.getElementById("addCareer").addEventListener('click', addCareer, false);
document.getElementById("download").addEventListener('click', download, false);
document.getElementById("deleteButton").addEventListener('click', deleteButton, false);
document.getElementById("print").addEventListener('click', print, false);

{
    // 画面幅800px
    window.screen.availWidth=800;

    const date = new Date();
    const year = date.getFullYear();
    const month = date.getMonth()+1;
    const day = date.getDate();
    const today = `作成日：${year}/${month}/${day}`;
    document.getElementById("today").innerText = today;
    if (!index) addCareer();
}
</script>


</body></html>